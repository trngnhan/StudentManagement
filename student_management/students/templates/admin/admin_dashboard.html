{% extends "base.html" %}
{% block title %}Trang chá»§ Admin{% endblock %}

{% block header %}
<div class="d-flex justify-content-between align-items-center">
    <h2 class="mb-0">ğŸ“Š Báº£ng Ä‘iá»u khiá»ƒn Quáº£n trá»‹</h2>
</div>
{% endblock %}

{% block content %}
<div class="row text-center mt-4">
  <div class="col"><h5>NhÃ¢n viÃªn</h5><p id="staff-count">...</p></div>
  <div class="col"><h5>GiÃ¡o viÃªn</h5><p id="teacher-count">...</p></div>
  <div class="col"><h5>Há»c sinh</h5><p id="student-count">...</p></div>
  <div class="col"><h5>Lá»›p há»c</h5><p id="classroom-count">...</p></div>
  <div class="col"><h5>MÃ´n há»c</h5><p id="subject-count">...</p></div>
</div>

<div class="text-center mt-5 d-flex justify-content-center flex-wrap gap-3">
    <a href="/subject_manage/" class="btn btn-outline-dark">
     Quáº£n lÃ½ mÃ´n há»c
    </a>
    <a href="/schoolyear_manage/" class="btn btn-outline-info">
     Quáº£n lÃ½ nÄƒm há»c - há»c ká»³
    </a>
    <a href="/rules_list/" class="btn btn-outline-danger">
     Quy Ä‘á»‹nh
    </a>
    <a href="/rules/" class="btn btn-outline-danger">
     Xem bÃ¡o cÃ¡o thá»‘ng kÃª
    </a>
</div>

<script>
  async function ensureToken() {
    let token = "{{ access_token|default:'' }}";
    sessionStorage.setItem("access", token);

    if (!token) {
      const serverToken = "{{ request.session.access|default:'' }}";
      if (serverToken) {
        sessionStorage.setItem("access", serverToken);
        token = serverToken;
        console.log("Láº¥y token tá»« session server.");
      }
    }

    if (!token) {
      alert("ChÆ°a cÃ³ token, vui lÃ²ng Ä‘Äƒng nháº­p.");
      return window.location.href = "/login/";
    }

    return token;
  }

  // Gá»i thá»­:
  ensureToken().then(token => {
    fetch("/users/me/", {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(data => console.log("ThÃ´ng tin ngÆ°á»i dÃ¹ng:", data))
    .catch(err => console.error("KhÃ´ng láº¥y Ä‘Æ°á»£c /users/me/:", err));
  });
</script>
{% endblock %}