{% extends "base.html" %}
{% block title %}Trang chá»§ Admin{% endblock %}

{% block header %}
<div class="d-flex justify-content-between align-items-center">
    <h2 class="mb-0">ğŸ“Š Báº£ng Ä‘iá»u khiá»ƒn Quáº£n trá»‹</h2>
</div>
{% endblock %}

{% block content %}
<div class="row text-center mt-4">
  <div class="col"><h5>NhÃ¢n viÃªn</h5><p id="staff-count">...</p></div>
  <div class="col"><h5>GiÃ¡o viÃªn</h5><p id="teacher-count">...</p></div>
  <div class="col"><h5>Há»c sinh</h5><p id="student-count">...</p></div>
  <div class="col"><h5>Lá»›p há»c</h5><p id="classroom-count">...</p></div>
  <div class="col"><h5>MÃ´n há»c</h5><p id="subject-count">...</p></div>
</div>

<div class="text-center mt-5 d-flex justify-content-center flex-wrap gap-3">
    <a href="/subject_manage/" class="btn btn-outline-dark">
     Quáº£n lÃ½ mÃ´n há»c
    </a>
    <a href="/schoolyear-semesters/" class="btn btn-outline-info">
     Quáº£n lÃ½ nÄƒm há»c - há»c ká»³
    </a>
    <a href="/rules/" class="btn btn-outline-danger">
     Thay Ä‘á»•i quy Ä‘á»‹nh
    </a>
    <a href="/rules/" class="btn btn-outline-danger">
     Xem bÃ¡o cÃ¡o thá»‘ng kÃª
    </a>
</div>

<script>
  const token = "{{ request.session.access|default:'' }}";
  console.log("ğŸš€ Sending token to API:", token);

  fetch('/admin-info/dashboard/', {
      headers: {
          'Authorization': 'Bearer ' + token
      }
  })
  .then(async res => {
      const contentType = res.headers.get("content-type");
      if (!contentType || !contentType.includes("application/json")) {
          const text = await res.text();
          console.warn("âš ï¸ Pháº£n há»“i khÃ´ng pháº£i JSON:", text);
          throw new Error("API tráº£ vá» khÃ´ng pháº£i JSON (cÃ³ thá»ƒ lÃ  lá»—i hoáº·c chÆ°a Ä‘Äƒng nháº­p)");
      }
      return res.json();
  })
  .then(data => {
      document.getElementById("staff-count").innerText = data.total_staff;
      document.getElementById("teacher-count").innerText = data.total_teacher;
      document.getElementById("student-count").innerText = data.total_student;
      document.getElementById("classroom-count").innerText = data.total_classroom;
      document.getElementById("subject-count").innerText = data.total_subject;
  })
  .catch(err => alert("âŒ " + err.message));
</script>
{% endblock %}